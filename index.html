<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Act Out That Sound</title>
  <meta name="theme-color" content="#1b3c4b" />
  <link rel="manifest" href="manifest.json">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
:root {
  --bg: #fdf3de;
  --ink: #213547;
  --brand: #eb6e52;
  --brand-dark: #ea694d;
  --muted: #5a6b75;
  --card: #ffffff;
  --radius: 18px;
  --shadow: 0 6px 24px rgba(0,0,0,.08);
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: var(--ink);
  line-height: 1.5;
  text-align: center;
}
.container { max-width: 720px; margin: 0 auto; padding: 20px 16px 64px; }
header { margin: 16px 0 24px; }
h1 { font-size: 1.8rem; color: var(--brand-dark); }

.card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px;
  margin: 20px auto;
}

button {
  appearance: none;
  border: 0;
  padding: 14px 20px;
  border-radius: 14px;
  font-weight: 700;
  cursor: pointer;
  background: var(--brand);
  color: #fff;
  box-shadow: 0 4px 14px rgba(0,0,0,.08);
  margin: 6px;
}
button.secondary { background: #edf6f9; color: var(--brand-dark); }

.muted { color: var(--muted); font-size: 14px; margin-top: 6px; }
footer { font-size: 12px; color:#666; margin-top: 40px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸŽµ Act Out That Sound!</h1>
      <p class="muted">Tap for a random sound. Act it out with your face, voice, or body!</p>
    </header>

    <section class="card">
      <h2>Dare to Add a Sound Effect</h2>
      <p class="muted">Tap for a random sound and try to work it into the story</p>
      <div class="btns">
        <button id="btnSound">Play a Sound</button>
        <button class="secondary" id="btnSoundBack">Back</button>
        <button class="secondary" id="btnSoundFwd">Forward</button>
      </div>
      <p id="soundNow" class="muted">No sound played yet</p>
    </section>

    <section class="card">
      <h2>Record Your Own!</h2>
      <div id="recStatus">Ready to record. Your audio stays on your device.</div>
      <div>
        <button id="btnRecStart">Start</button>
        <button class="secondary" id="btnRecStop" disabled>Stop</button>
        <button class="secondary" id="btnRecPlay" disabled>Play</button>
        <button class="secondary" id="btnRecDownload" disabled>Download</button>
      </div>
      <audio id="player" controls style="width:100%; margin-top:10px; display:none"></audio>
      <p class="muted">Want your sound featured? After recording, download it and <a href="YOUR_GOOGLE_FORM_LINK" target="_blank">upload it here</a>.</p>
    </section>
  </div>

  <footer>
    Â© 2025 Mia Wisinski, Playful Heart Parenting. Please do not share this link publicly or distribute without explicit permission.
  </footer>

  <script>
/* ===================
   Sound effect deck
=================== */
const SFX_FILES = Array.from({length:112}, (_,i)=>`sfx/sfx-${i+1}.mp3`);
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function makeDeck(items){
  let order = shuffle([...items]), idx=0, hist=[], pos=0;
  function save(){ localStorage.setItem('sfxHist', JSON.stringify({order,idx,hist,pos})); }
  function load(){ try{ const s=JSON.parse(localStorage.getItem('sfxHist')); if(s){order=s.order;idx=s.idx;hist=s.hist;pos=s.pos;} }catch{} }
  load();
  function current(){ if(!hist.length||pos===0)return null; return pos===hist.length?hist[hist.length-1]:hist[pos-1]; }
  function canBack(){ return pos>1; }
  function canFwd(){ return pos<hist.length; }
  function next(){ if(pos<hist.length)hist.splice(pos); const pick=order[idx]; idx++; if(idx>=order.length){order=shuffle([...items]);idx=0;} hist.push(pick); pos=hist.length; save(); return pick; }
  function back(){ if(!canBack())return null; pos--; save(); return hist[pos-1]; }
  function fwd(){ if(!canFwd())return null; const i=hist[pos]; pos++; save(); return i; }
  return {next,back,fwd,canBack,canFwd,current};
}
const deckSfx = makeDeck(SFX_FILES);
const btnSound=document.getElementById('btnSound');
const btnSoundBack=document.getElementById('btnSoundBack');
const btnSoundFwd=document.getElementById('btnSoundFwd');
const soundNow=document.getElementById('soundNow');
let audio=new Audio();

function playSfx(file){
  audio.src=file; audio.play();
  soundNow.textContent=`Now playing: ${file.split('/').pop()}`;
}
btnSound.addEventListener('click',()=>{const f=deckSfx.next(); if(f) playSfx(f); btnSoundBack.disabled=!deckSfx.canBack(); btnSoundFwd.disabled=!deckSfx.canFwd();});
btnSoundBack.addEventListener('click',()=>{const f=deckSfx.back(); if(f) playSfx(f); btnSoundBack.disabled=!deckSfx.canBack(); btnSoundFwd.disabled=!deckSfx.canFwd();});
btnSoundFwd.addEventListener('click',()=>{const f=deckSfx.fwd(); if(f) playSfx(f); btnSoundBack.disabled=!deckSfx.canBack(); btnSoundFwd.disabled=!deckSfx.canFwd();});

/* ===================
   Recorder (local only)
=================== */
const recStart=document.getElementById('btnRecStart');
const recStop=document.getElementById('btnRecStop');
const recPlay=document.getElementById('btnRecPlay');
const recDl=document.getElementById('btnRecDownload');
const recStatus=document.getElementById('recStatus');
const player=document.getElementById('player');
let mediaRecorder=null, mediaStream=null, chunks=[], lastBlobUrl=null;

function pickSupportedMime(){
  const list=["audio/mp4;codecs=aac","audio/mp4","audio/webm;codecs=opus","audio/webm"];
  for(const t of list){ if(MediaRecorder.isTypeSupported(t)) return t; }
  return "";
}
function extFromMime(m){const s=(m||"").toLowerCase(); if(s.includes("mp4"))return"m4a"; if(s.includes("webm"))return"webm"; return"audio";}
recStart.addEventListener('click', async ()=>{
  try{
    mediaStream=await navigator.mediaDevices.getUserMedia({audio:true, video:false});
    const mime=pickSupportedMime();
    mediaRecorder=new MediaRecorder(mediaStream, mime?{mimeType:mime}:undefined);
    chunks=[];
    mediaRecorder.ondataavailable=e=>{if(e.data&&e.data.size)chunks.push(e.data);};
    mediaRecorder.onstop=()=>{
      const type=mediaRecorder.mimeType||mime||"audio/webm";
      const blob=new Blob(chunks,{type});
      if(lastBlobUrl)URL.revokeObjectURL(lastBlobUrl);
      lastBlobUrl=URL.createObjectURL(blob);
      player.src=lastBlobUrl; player.style.display='block';
      recPlay.disabled=false; recDl.disabled=false;
      recStatus.textContent='Recording ready to play or download';
      if(mediaStream){mediaStream.getTracks().forEach(t=>t.stop());mediaStream=null;}
      const ext=extFromMime(type);
      recDl.onclick=()=>{const a=document.createElement('a');a.href=lastBlobUrl;a.download=`my-sound.${ext}`;a.click();};
    };
    mediaRecorder.start();
    recStatus.textContent='Recordingâ€¦';
    recStart.disabled=true; recStop.disabled=false; recPlay.disabled=true; recDl.disabled=true;
  }catch{ recStatus.textContent='Microphone not available or permission denied.'; }
});
recStop.addEventListener('click',()=>{if(mediaRecorder&&mediaRecorder.state!=='inactive'){mediaRecorder.stop();} recStart.disabled=false; recStop.disabled=true;});
recPlay.addEventListener('click',()=>{if(player.src)player.play();});
  </script>
</body>
</html>
